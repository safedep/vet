#!/bin/bash

set -ex

# Not a malicious package
$E2E_VET_INSPECT_MALWARE_CMD --purl pkg:/npm/@clerk/nextjs@6.9.6 \
  --malware --malware-analysis-timeout 60s --fail-fast

# Not a malicious package - without version
$E2E_VET_INSPECT_MALWARE_CMD --purl pkg:/npm/@clerk/nextjs \
  --malware --malware-analysis-timeout 60s --fail-fast

# Not a malicious package - latest version
$E2E_VET_INSPECT_MALWARE_CMD --purl pkg:/npm/@clerk/nextjs@latest \
  --malware --malware-analysis-timeout 60s --fail-fast

# GitHub Actions - without version
$E2E_VET_INSPECT_MALWARE_CMD --purl pkg:/github/actions/checkout \
  --malware --malware-analysis-timeout 60s --fail-fast

# GitHub Actions - with @latest version
$E2E_VET_INSPECT_MALWARE_CMD --purl pkg:/github/actions/checkout@latest \
  --malware --malware-analysis-timeout 60s --fail-fast

# This is a malicious package
$E2E_VET_INSPECT_MALWARE_CMD --purl pkg:/npm/llm-oracle@1.0.2 \
  --malware --malware-analysis-timeout 60s --fail-fast --malware-trust-tool-result || exit 0

# Fail if we don't already exit on malicious package detection
exit 1
